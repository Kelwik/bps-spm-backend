// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// MODEL BARU: Untuk menyimpan data pengguna
model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String
  password  String
  role      UserRole @default(op_satker)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // ðŸ‘‡ PERUBAHAN DI SINI: Relasi Satker dibuat opsional
  satkerId Int?
  satker   Satker? @relation(fields: [satkerId], references: [id])
}

model Satker {
  id         Int    @id @default(autoincrement())
  kodeSatker String @unique
  nama       String
  eselon     String
  spms       Spm[]
  users      User[]
}

model Spm {
  id            Int      @id @default(autoincrement())
  nomorSpm      String   @unique
  tahunAnggaran Int
  tanggal       DateTime
  totalAnggaran Int

  satkerId Int
  satker   Satker @relation(fields: [satkerId], references: [id])
  rincian  SpmRincian[]
}

model SpmRincian {
  id           Int    @id @default(autoincrement())
  kodeProgram  String
  kodeKegiatan String
  jumlah       Int

  spmId        Int
  spm          Spm        @relation(fields: [spmId], references: [id], onDelete: Cascade)
  kodeAkunId   Int
  kodeAkun     KodeAkun   @relation(fields: [kodeAkunId], references: [id])
  jawabanFlags JawabanFlag[]
}

model JawabanFlag {
  id           Int      @id @default(autoincrement())
  nama         String
  tipe         FlagType
  rincianSpmId Int
  rincianSpm   SpmRincian @relation(fields: [rincianSpmId], references: [id], onDelete: Cascade)

  @@unique([rincianSpmId, nama])
}

model KodeAkun {
  id            Int          @id @default(autoincrement())
  kode          String       @unique
  nama          String
  templateFlags Flag[]
  rincian       SpmRincian[]
}

model Flag {
  id         Int      @id @default(autoincrement())
  nama       String
  tipe       FlagType
  kodeAkunId Int
  kodeAkun   KodeAkun @relation(fields: [kodeAkunId], references: [id])

  @@unique([kodeAkunId, nama])
}

enum FlagType {
  IYA
  TIDAK
  IYA_TIDAK
}

enum UserRole {
  supervisor
  op_prov
  op_satker
  viewer
}

